---
layout:     post
title:      从输入url到页面响应过程
subtitle:   H.T. Blog 从输入url到页面响应过程中经历了什么
date:       2019-08-02
author:     haotian
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - 页面渲染流程
---

## 文章目录
1. 渲染步骤

    1、浏览器的地址输入URL并按下回车；

    2、浏览器查找当前URL是否存在缓存，并比较缓存是否过期；

    3、DNS解析URL对应的IP；

    4、根据IP建立TCP连接(三次握手)；

    5、HTTP发起请求；

    6、服务器处理请求，浏览器接收HTTP响应；

    7、渲染页面，构建DOM树；

    8、关闭TCP连接(四次挥手)；

## 1.详细的流程明细
打开浏览器，在URL地址栏中输入一个地址，比如：https://www.baidu.com到响应百度主页，经历的过程如下：

    1、浏览器的地址输入URL并按下回车；
    2、浏览器查找当前URL是否存在缓存，并比较缓存是否过期；
    3、DNS解析URL对应的服务器IP，通过DNS服务器来完成；
    4、根据IP建立TCP连接(三次握手)；

        客户端发送一个SYN码给服务器，要求建立数据连接；
        服务器SYN和自己处理一个SYN(标志)：叫SYN+ACK(确认包)；发送给客户端，可以建立连接；
        客户端再次发送ACK给服务器，服务器验证ACK没有问题，则建立连接；

    5、HTTP发起请求；
    6、服务器处理请求，浏览器接收HTTP响应；

        服务器解析HTTP请求，服务器调用相应的资源文件以及对应的数据库数据，返回响应

    7、浏览器解析HTML并渲染页面，构建DOM树
    8、关闭TCP连接(四次挥手)

        客户端给服务端发送消息表示这边没有数据要传了，发出关闭连接的请求
        服务器收到请求后，表示要确认下自己这边有没有数据要传
        服务器确认后表示这边没有数据要传输，可以关闭连接了
        客户端收到消息后正式关闭连接

## 2、浏览器渲染流程
    1、浏览器将获取的HTML文档解析成DOM树；
    2、处理CSS标记，构成层叠样式表模型CSSOM(CSS Object Model)；
    3、将DOM和CSSOM合并渲染树将会被创建，代表一系列将被渲染的对象；
    4、渲染树的每个元素包含的内容都是计算过的，称之为布局layout。浏览器使用一种流式处理方法，只需要一次绘制操作就可以布局所有元素；
    5、将渲染树的各个节点绘制到屏幕上，称之为绘制painting；
## 3、四词挥手
    1、客户端发送FIN(结束)报文，通知服务器数据已经传输完毕；
    2、服务器接收到以后，通知客户端已收到SYN，发送ACK(确认)给客户端，数据还没有传输完成；
    3、服务器已经传输完毕，再次发送FIN通知客户端，数据已经传输完毕；
    4、客户端再次发送ACK，进入TIME_WAIT状态，服务器和客户端关闭连接；
## 4、为什么建立连接是三次握手，而断开连接是四次挥手呢?
    建立连接的时候， 服务器在LISTEN状态下，收到建立连接请求的SYN报文后，把ACK和SYN放在一个报文里发送给客户端。 

    关闭连接时，服务器收到对方的FIN报文时，仅仅表示对方不再发送数据了但是还能接收数据，而自己也未必全部数据都发送给对方了，所以己方可以立即关闭，也可以发送一些数据给对方后，再发送FIN报文给对方来表示同意现在关闭连接，因此，己方ACK和FIN一般都会分开发送，从而导致多了一次。