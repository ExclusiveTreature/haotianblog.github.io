---
layout:     post
title:      Webpack知识点整理
subtitle:   H.T. Blog 知识点整理持续更新...
date:       2019-11-22
author:     haotian
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - Webpack知识点整理
---

## 文章目录
1. Webpack知识点目录

> webpack 4.41.0

> node 10.16.0

## 1、 入门
### 1.1 初始化项目
新建一个目录，初始化npm

    npm init

webpack是运行在node环境中的,我们需要安装以下两个npm包

    npm i -D webpack webpack-cli
    npm i -D 为npm install --save-dev的缩写
    npm i -S 为npm install --save的缩写

新建一个文件夹src ,然后新建一个文件main.js,写一点代码测试一下

    console.log('测试文件')

配置package.json命令

  "scripts": {
    "build": "webpack --config build/webpack.config.js"
  },

执行

    npm run build

此时如果生成了一个dist文件夹，并且内部含有main.js说明已经打包成功了

### 1.2 开始我们自己的配置
上面一个简单的例子只是webpack自己默认的配置，下面我们要实现更加丰富的自定义配置

新建一个build文件夹,里面新建一个webpack.config.js

    // webpack.config.js

    const path = require('path');
    module.exports = {
        mode:'development', // 开发模式
        entry: path.resolve(__dirname,'../src/main.js'),    // 入口文件
        output: {
            filename: 'output.js',      // 打包后的文件名称
            path: path.resolve(__dirname,'../dist')  // 打包后的目录
        }
    }
更改我们的打包命令

  "scripts": {
    "build": "webpack --config build/webpack.config.js"
  },
执行 npm run build

其中dist文件夹中的output.js就是我们需要在浏览器中实际运行的文件

当然实际运用中不会仅仅如此,下面让我们通过实际案例带你快速入手webpack

### 1.3 配置html模板
js文件打包好了,但是我们不可能每次在html文件中手动引入打包好的js

    module.exports = {
        // 省略其他配置
        output: {
        filename: '[name].[hash:8].js',      // 打包后的文件名称
        path: path.resolve(__dirname,'../dist')  // 打包后的目录
        }
    }

这时候生成的dist目录文件如下

![](https://user-gold-cdn.xitu.io/2019/12/11/16ef2e08b877e7f5?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

为了缓存，你会发现打包好的js文件的名称每次都不一样。webpack打包出来的js文件我们需要引入到html中，但是每次我们都手动修改js文件名显得很麻烦，因此我们需要一个插件来帮我们完成这件事情

    npm i -D html-webpack-plugin

新建一个build同级的文件夹public,里面新建一个index.html

具体配置文件如下

    // webpack.config.js
    const path = require('path');
    const HtmlWebpackPlugin = require('html-webpack-plugin')
    module.exports = {
        mode:'development', // 开发模式
        entry: path.resolve(__dirname,'../src/main.js'),    // 入口文件
        output: {
            filename: '[name].[hash:8].js',      // 打包后的文件名称
            path: path.resolve(__dirname,'../dist')  // 打包后的目录
        },
        plugins:[
            new HtmlWebpackPlugin({
                template:path.resolve(__dirname,'../public/index.html')
            })
        ]
    }
生成目录如下(图片)

![](https://user-gold-cdn.xitu.io/2019/12/11/16ef2e135693a259?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

可以发现打包生成的js文件已经被自动引入html文件中

#### 1.3.1 多入口文件如何开发

生成多个html-webpack-plugin实例来解决这个问题

    const path = require('path');
    const HtmlWebpackPlugin = require('html-webpack-plugin')
    module.exports = {
        mode:'development', // 开发模式
        entry: {
            main:path.resolve(__dirname,'../src/main.js'),
            header:path.resolve(__dirname,'../src/header.js')
        }, 
        output: {
            filename: '[name].[hash:8].js',      // 打包后的文件名称
            path: path.resolve(__dirname,'../dist')  // 打包后的目录
        },
        plugins:[
            new HtmlWebpackPlugin({
                template:path.resolve(__dirname,'../public/index.html'),
                filename:'index.html',
                chunks:['main'] // 与入口文件对应的模块名
            }),
            new HtmlWebpackPlugin({
                template:path.resolve(__dirname,'../public/header.html'),
                filename:'header.html',
                chunks:['header'] // 与入口文件对应的模块名
            }),
        ]
    }

此时会发现生成以下目录

![](https://user-gold-cdn.xitu.io/2019/12/11/16ef2e1ff51375aa?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

1.3.2 clean-webpack-plugin

> 每次执行npm run build 会发现dist文件夹里会残留上次打包的文件，这里我们推荐一个plugin来帮我们在打包输出前清空文件夹clean-webpack-plugin

    const {CleanWebpackPlugin} = require('clean-webpack-plugin')
    module.exports = {
        // ...省略其他配置
        plugins:[new CleanWebpackPlugin()]
    }
## 1.4 引用CSS
我们的入口文件是js，所以我们在入口js中引入我们的css文件

同时我们也需要一些loader来解析我们的css文件

    npm i -D style-loader css-loader

如果我们使用less来构建样式，则需要多安装两个

    npm i -D less less-loader

配置文件如下

    // webpack.config.js
    module.exports = {
        // ...省略其他配置
        module:{
        rules:[
            {
            test:/\.css$/,
            use:['style-loader','css-loader'] // 从右向左解析原则
            },
            {
            test:/\.less$/,
            use:['style-loader','css-loader','less-loader'] // 从右向左解析原则
            }
        ]
        }
    } 

浏览器打开html如下

![](https://user-gold-cdn.xitu.io/2019/12/11/16ef2e4dc3ba12b4?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)